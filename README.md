xal token toolkit

xal is the fingerprint token used by talon sdk on epic games login.
the token is a json fingerprint (15 fields) that gets shuffled, serialized, compressed, then encrypted.

encoding pipeline:
  fingerprint json -> mt19937 shuffle -> fnv-1a hash each entry -> serialize with length prefixes -> zlib deflate -> chacha20 encrypt -> base64

token binary format:
  base64(nonce[12 bytes] + random[4 bytes LE] + chacha20_ciphertext)

inner format after decryption:
  fnv1a_hash[4] + compressed_len[4] + deflated_data

after inflate, entries are:
  repeated { fnv1a_hash[4] + json_len[4] + json_bytes } + checksum[4]

the shuffle uses fisher-yates with mt19937 prng seeded by `random`.
checksum is fnv1a running hash XOR'd with `random`.
chacha20 nonce is base_nonce XOR'd with `random` per-word.

---

files

  config.json
    chacha20 key (32 bytes hex) and base nonce (12 bytes hex).
    auto-generated by the extractor. update this when epic rotates the key.

  extractor/deob.js
    deobfuscates xal.js and extracts the chacha20 key + nonce.
    resolves string decoders, folds constants, cleans up the AST.
    writes config.json and deobfuscated.js.

    how key extraction works:
      after deobfuscation, the script walks the cleaned AST looking for
      functions that return `new Uint8Array([...32 elements...])` (the key)
      and `new Uint32Array([...3 elements...])` (the nonce). it matches by
      structure not by variable name, so it works even when epic renames
      everything. once found, it evals the function body in a sandboxed vm
      to get the actual byte values and writes them to config.json as hex.

    usage: paste fresh xal.js in root, then run
      node extractor/deob.js

  gen.js
    generates a realistic xal token with randomized dynamic fields.
    static fields (gpu, property lists, stack trace, resources) are from a real browser.
    dynamic fields (timestamp, session id, visitor_id, hashes, mouse/keyboard events) are randomized.

    usage:
      node gen.js
    outputs: {"xal":"base64...","ewa":"b","kid":"Yjqmlr"}

  debug/decoder.js
    decodes an xal token back to the fingerprint json.

    usage:
      node debug/decoder.js [config.json] [xal.txt]
    defaults to config.json in root and xal.txt in root.

  debug/encoder.js
    encodes a fingerprint json into an xal token. reads data from xal_data.json.

    usage:
      node debug/encoder.js [config.json] [xal_data.json]

---

workflow

1. grab xal.js from talon_sdk (view-source https://talon-website-prod.ecosec.on.epicgames.com/talon_sdk.js)
2. node extractor/deob.js -> updates config.json with new key
3. node gen.js -> gives you a fresh xal token

key rotates daily so run the extractor each day with a fresh xal.js.
